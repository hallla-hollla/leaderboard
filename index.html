<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>STEP'N Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./stepn.css?v=3">
</head>

<body>

<!-- MOVING TICKER -->
<div class="ticker">
  <div class="ticker-track">
    <img src="./images/ticker.png" alt="">
    <img src="./images/ticker.png" alt="">
    <img src="./images/ticker.png" alt="">
    <img src="./images/ticker.png" alt="">
    <!-- 복제 -->
    <img src="./images/ticker.png" alt="">
    <img src="./images/ticker.png" alt="">
    <img src="./images/ticker.png" alt="">
    <img src="./images/ticker.png" alt="">
  </div>
</div>

<!-- HEADER -->
<div class="header-wrap">
  <div class="header-plate">
    <div class="header-title">LEADERBOARD</div>
  </div>
</div>

<div id="leaderboard"></div>

<script>
/* ===== CONFIG ===== */
const API_KEY = "AIzaSyD_V3tdvx1alGwahTDgDLyUN2JEviAVoGI";
const SHEET_ID = "10kNJP47pryP1tQPUiqbMwOKuNKfF-MThv5q9yNoC0x8";
const SHEET_RANGE = "마일리지!A9:D500";

/* ===== LOAD ===== */
function loadData() {
  fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(SHEET_RANGE)}?key=${API_KEY}`)
    .then(res => res.json())
    .then(data => {
      const users = (data.values || [])
        .filter(r => r[1] && r[2])
        .map(r => ({
          name: r[1],
          target: Number(r[2]),
          progress: Number(r[3]) || 0
        }));
      render(users);
    });
}

function render(users) {
  const el = document.getElementById("leaderboard");
  el.innerHTML = "";

  [200,100,50].forEach(goal => {
    const group = users.filter(u=>u.target===goal).sort((a,b)=>b.progress-a.progress);
    if(!group.length) return;

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h2><img src="./images/symbol.png" class="icon">${goal} KM</h2>
    `;

    group.forEach((u,i)=>{
      const rate = Math.min(u.progress/goal*100,100);
      card.innerHTML += `
        <div class="row">
          <div class="row-header">
            <div><span class="rank">${i+1}</span>${u.name}</div>
            <div>${u.progress.toFixed(1)} km</div>
          </div>
          <div class="bar-bg"><div class="bar" style="width:${rate}%"></div></div>
        </div>
      `;
    });

    el.appendChild(card);
  });
}

loadData();
setInterval(loadData,60000);
</script>
</body>
</html>
